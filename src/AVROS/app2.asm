/*
 * app2.asm
 *  Counter
 *  Created: 5/22/2013 7:44:46 AM
 *   Author: Hamid
 */
 .equ	PRESSED_TIME = RAMSA
 app2:
 IN		A,DDRB
 ORI	A,0xF0
 OUT	DDRB,A
 LOOP2:
  SBIS	PINB,3
  RJMP	LOOP2
KEY_DOWN:
  SBIC	PINB,3
  RJMP	KEY_DOWN
  ADIW	XL,1
  MOV	B,XL
  ANDI	B,0x0F
  IN	A,PORTB
  OR	A,B
  LSL	A
  LSL	A
  LSL	A
  LSL	A
  OUT	PORTB,A
  PUSH	XL
  PUSH	XH
  MOV	A,XL
  MOV	B,XH
  LDI	XL,LOW(PRESSED_TIME)
  LDI	XH,HIGH(PRESSED_TIME)
  CALL	itoa
  LDI	XL,LOW(PRESSED_TIME)
  LDI	XH,HIGH(PRESSED_TIME)
  LDI	A,LCD_LOCK
  CALL	Setlock
  CALL	LCD_CLS
  CALL	LCD_PUTS
  LDI	A,LCD_LOCK
  CALL	SetUnlock
  POP	XH
  POP	XL
rjmp LOOP2